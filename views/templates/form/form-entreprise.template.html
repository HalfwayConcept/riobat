        <!-- Recherche d'adresse universelle avec loupe -->
        <div class="mb-4 relative">
            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Recherche d'adresse</label>
            <div class="relative">
                <input type="text" id="search_adresse_##type##" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 pr-10 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Rechercher une adresse..." autocomplete="off" />
                <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                </span>
                <ul id="search_adresse_##type##_suggestions" class="bg-white border border-gray-300 rounded-lg mt-1 max-h-40 overflow-y-auto hidden z-10 absolute w-full"></ul>
            </div>
        </div>
        <script>
        // Recherche d'adresse universelle avec remplissage automatique
        function fillAdresseFieldsFromSelection(feature, type) {
            // Remplir les champs du formulaire avec les propriétés de l'adresse sélectionnée
            if (feature && feature.properties) {
                var adresse = feature.properties.name || feature.properties.label || '';
                var cp = feature.properties.postcode || '';
                var ville = feature.properties.city || '';
                // Adapter les IDs/names selon le contexte d'utilisation
                var adresseInput = document.getElementById(type + '_entreprise_adresse');
                var cpInput = document.querySelector('input[name="' + type + '_entreprise_code_postal"]');
                var villeInput = document.querySelector('input[name="' + type + '_entreprise_commune"]');
                if (adresseInput) adresseInput.value = adresse;
                if (cpInput) cpInput.value = cp;
                if (villeInput) villeInput.value = ville;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            var input = document.getElementById('search_adresse_##type##');
            var ul = document.getElementById('search_adresse_##type##_suggestions');
            let timeoutAdresse;
            if (!input || !ul) return;
            input.addEventListener('input', function() {
                const query = input.value;
                clearTimeout(timeoutAdresse);
                if (query.length < 3) {
                    ul.classList.add('hidden');
                    return;
                }
                timeoutAdresse = setTimeout(() => {
                    fetch('https://api-adresse.data.gouv.fr/search/?q=' + encodeURIComponent(query) + '&limit=7')
                        .then(response => response.json())
                        .then(data => {
                            ul.innerHTML = '';
                            if (!data.features || data.features.length === 0) {
                                ul.classList.add('hidden');
                                return;
                            }
                            data.features.forEach(feature => {
                                const li = document.createElement('li');
                                li.textContent = feature.properties.label;
                                li.className = 'px-4 py-2 cursor-pointer hover:bg-blue-100';
                                li.onclick = function() {
                                    input.value = feature.properties.label;
                                    ul.classList.add('hidden');
                                    fillAdresseFieldsFromSelection(feature, '##type##');
                                };
                                ul.appendChild(li);
                            });
                            ul.classList.remove('hidden');
                        });
                }, 300);
            });
            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !ul.contains(e.target)) {
                    ul.classList.add('hidden');
                }
            });
        });
        </script>
    
    <input type="hidden" value="##valeur_entreprise_id##" name="##type##_entreprise_id">
    <div class="grid gap-6 mb-2 md:grid-cols-2">
        <div class="mb-2 flex items-center">  
            ##icon##          
            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nom entreprise ou raison sociale</label><br />
        </div>
        <div class="w-full">
            <input type="text" value="##valeur_entreprise_raison_sociale##" id="##type##_entreprise_raison_sociale" name="##type##_entreprise_raison_sociale" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
        </div>
    </div>    

    <div class="grid gap-6 mb-2 md:grid-cols-2">
        <div>
            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nom</label>
            <input type="text" value="##valeur_entreprise_nom##" name="##type##_entreprise_nom" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
        </div>
        <div>
            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Prénom</label>
            <input type="text" value="##valeur_entreprise_prenom##" name="##type##_entreprise_prenom" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
        </div>
    </div>
    <div class="mb-2 relative">
        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Adresse</label>
        <input type="text" 
            value="##valeur_entreprise_adresse##" 
            name="##type##_entreprise_adresse" 
            id="##type##_entreprise_adresse" 
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
            placeholder="Saisir l'adresse"
            autocomplete="off" />
        <!-- Suggestions d'adresses -->
        <ul id="##type##_adresse_suggestions" class="bg-white border border-gray-300 rounded-lg mt-1 max-h-40 overflow-y-auto hidden z-10 absolute w-full"></ul>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof adresseAutocomplete === 'function') {
                adresseAutocomplete('##type##_entreprise_adresse', '##type##_adresse_suggestions');
            }
        });
        </script>
    </div>    
    <div class="grid gap-6 mb-2 md:grid-cols-2">
        <div>
            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Code postal</label>
            <input type="text" value="##valeur_entreprise_code_postal##" name="##type##_entreprise_code_postal" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
        </div>
        <div>
            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Commune</label>
            <input type="text" value="##valeur_entreprise_commune##" name="##type##_entreprise_commune" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
        </div>
    </div>
    <div class="mb-2">
        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">SIRET n°</label>
        <input type="text" value="##valeur_entreprise_numero_siret##"  name="##type##_entreprise_numero_siret" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
    </div>

